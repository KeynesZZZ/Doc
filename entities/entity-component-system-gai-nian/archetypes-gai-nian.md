# Archetypes 概念

原型是所有具有相同组件类型组合的世界中实体的唯一标识符。例如，世界中所有具有组件类型 A 和 B 的实体共享一个原型。所有具有组件类型 A、B 和 C 的实体共享另一个原型，而所有具有组件类型 A 和 Z 的实体又共享另一个原型。

当你向实体添加或删除组件类型时，世界的 `EntityManager` 会将实体移动到适当的原型。例如，如果一个实体具有组件类型 A、B 和 C，而你移除了它的 B 组件，`EntityManager` 会将该实体移动到具有组件类型 A 和 C 的原型中。如果不存在这样的原型，`EntityManager` 会创建它。

> **重要**: 频繁移动实体是资源密集型操作，会降低应用程序的性能。有关更多信息，请参阅结构性变化概念的文档。

基于原型的实体组织方式意味着按其组件类型查询实体非常高效。例如，如果你想找到所有具有组件类型 A 和 B 的实体，可以找到具有这些组件类型的所有原型，这比扫描所有单个实体更有效。世界中的现有原型集合在程序生命周期的早期趋于稳定，因此可以缓存查询以获得更快的性能。

一个原型只有在其世界被销毁时才会被销毁。

#### 原型块

所有具有相同原型的实体和组件存储在称为 chunk 的统一内存块中。每个 chunk 包含 16KiB，其能存储的实体数量取决于 chunk 原型中组件的数量和大小。`EntityManager` 根据需要创建和销毁 chunks。

一个 chunk 为每种组件类型包含一个数组，以及一个用于存储实体 ID 的额外数组。例如，在具有组件类型 A 和 B 的原型中，每个 chunk 有三个数组：一个用于 A 组件值的数组，一个用于 B 组件值的数组，以及一个用于实体 ID 的数组。

chunk 的数组是紧密排列的：chunk 的第一个实体存储在这些数组的索引 0 处，chunk 的第二个实体存储在索引 1 处，随后的实体存储在连续的索引中。当将新实体添加到 chunk 时，它存储在第一个可用索引处。当从 chunk 中移除实体（无论是因为它被销毁还是被移动到另一个原型），chunk 的最后一个实体会被移动来填补空缺。

当实体添加到原型时，如果原型的现有 chunks 都已满，`EntityManager` 会创建一个新的 chunk。当最后一个实体从 chunk 中移除时，`EntityManager` 会销毁该 chunk。

#### 编辑器中的原型

原型窗口列出了项目中所有世界的原型，并显示每个原型分配和未使用的内存量。

在编辑器中，以下图标代表一个原型： 。
